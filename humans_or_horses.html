<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="ExDoc v0.28.5">
    <meta name="project" content="Axon v0.2.0">

    <title>Classifying humans and horses — Axon v0.2.0</title>
    <link rel="stylesheet" href="dist/elixir-64c5e2b63575bddb1c5b.css" />

    <script src="dist/sidebar_items-dc91cae1e4.js"></script>

      <script src="docs_config.js"></script>

    <script async src="dist/app-b5f3440501744dc8be3d.js"></script>


  </head>
  <body data-type="extras">
    <script>

      try {
        var settings = JSON.parse(localStorage.getItem('ex_doc:settings') || '{}');

        if (settings.theme === 'dark' ||
           ((settings.theme === 'system' || settings.theme == null) &&
             window.matchMedia('(prefers-color-scheme: dark)').matches)
           ) {
          document.body.classList.add('dark')
        }
      } catch (error) { }
    </script>

<div class="main">


<section class="sidebar">
  <button class="sidebar-button sidebar-toggle" aria-label="toggle sidebar">
    <i class="ri-menu-line ri-lg" title="Collapse/expand sidebar"></i>
  </button>

  <form class="sidebar-search" action="search.html">
    <button type="submit" class="search-button" aria-label="Submit Search">
      <i class="ri-search-2-line" aria-hidden="true" title="Submit search"></i>
    </button>
    <button type="button" tabindex="-1" class="search-close-button" aria-label="Cancel Search">
      <i class="ri-close-line ri-lg" aria-hidden="true" title="Cancel search"></i>
    </button>
    <label class="search-label">
      <p class="sr-only">Search</p>
      <input name="q" type="text" class="search-input" placeholder="Search..." aria-label="Input your search terms" autocomplete="off" />
    </label>
  </form>

  <div class="autocomplete">
    <div class="autocomplete-results">
    </div>
  </div>

  <div class="sidebar-header">

      <a href="Axon.html">
        <img src="assets/logo.png" alt="Axon" class="sidebar-projectImage">
      </a>

    <div class="sidebar-projectDetails">
      <a href="Axon.html" class="sidebar-projectName" translate="no">
Axon
      </a>
      <strong class="sidebar-projectVersion" translate="no">
        v0.2.0
      </strong>
    </div>
    <ul class="sidebar-listNav">
      <li><a id="extras-list-link" href="#full-list">Pages</a></li>

        <li><a id="modules-list-link" href="#full-list">Modules</a></li>


    </ul>
  </div>

  <div class="gradient"></div>
  <ul id="full-list" class="sidebar-fullList"></ul>
</section>

<section class="content">
  <output role="status" id="toast"></output>
  <div class="content-outer">
    <div id="content" class="content-inner">

<h1>
<button class="settings display-settings">
  <i class="ri-settings-3-line"></i>
  <span class="sr-only">Settings</span>
</button>


    <a href="https://github.com/elixir-nx/axon/blob/v0.2.0/notebooks/vision/humans_or_horses.livemd#L1" title="View Source" class="view-source" rel="help">
      <i class="ri-code-s-slash-line" aria-hidden="true"></i>
      <span class="sr-only">View Source</span>
    </a>

  <span>Classifying humans and horses</span>
</h1>

  <div class="livebook-badge-container">
    <a href="#" class="livebook-badge">
      <img src="https://livebook.dev/badge/v1/blue.svg" alt="Run in Livebook" width="150" />
    </a>
  </div>

<h2 id="general-overview" class="section-heading">
  <a href="#general-overview" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">general-overview</p>
  </a>
  General overview
</h2>
<p>In this notebook, we want to predict whether an image presents a human or a horse. To do this efficiently, we will build a convolutional neural net and compare the learning process with and without gradient centralization.</p><h2 id="imports" class="section-heading">
  <a href="#imports" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">imports</p>
  </a>
  Imports
</h2>
<pre><code class="makeup elixir" translate="no"><span class="nc">Mix</span><span class="o">.</span><span class="n">install</span><span class="p" data-group-id="5432039324-1">(</span><span class="p" data-group-id="5432039324-2">[</span><span class="w">
  </span><span class="p" data-group-id="5432039324-3">{</span><span class="ss">:stb_image</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.5.2&quot;</span><span class="p" data-group-id="5432039324-3">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5432039324-4">{</span><span class="ss">:axon</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.1.0&quot;</span><span class="p" data-group-id="5432039324-4">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5432039324-5">{</span><span class="ss">:exla</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.2&quot;</span><span class="p" data-group-id="5432039324-5">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5432039324-6">{</span><span class="ss">:nx</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.2.1&quot;</span><span class="p" data-group-id="5432039324-6">}</span><span class="p">,</span><span class="w">
  </span><span class="p" data-group-id="5432039324-7">{</span><span class="ss">:kino</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;~&gt; 0.6.2&quot;</span><span class="p" data-group-id="5432039324-7">}</span><span class="w">
</span><span class="p" data-group-id="5432039324-2">]</span><span class="p" data-group-id="5432039324-1">)</span><span class="w">

</span><span class="nc">EXLA</span><span class="o">.</span><span class="n">set_as_nx_default</span><span class="p" data-group-id="5432039324-8">(</span><span class="w">
  </span><span class="p" data-group-id="5432039324-9">[</span><span class="ss">:cuda</span><span class="p">,</span><span class="w"> </span><span class="ss">:tpu</span><span class="p">,</span><span class="w"> </span><span class="ss">:rocm</span><span class="p">,</span><span class="w"> </span><span class="ss">:host</span><span class="p" data-group-id="5432039324-9">]</span><span class="p">,</span><span class="w">
  </span><span class="ss">run_options</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="5432039324-10">[</span><span class="ss">keep_on_device</span><span class="p">:</span><span class="w"> </span><span class="no">true</span><span class="p" data-group-id="5432039324-10">]</span><span class="w">
</span><span class="p" data-group-id="5432039324-8">)</span></code></pre><h2 id="notebook-setup" class="section-heading">
  <a href="#notebook-setup" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">notebook-setup</p>
  </a>
  Notebook Setup
</h2>
<p>The data for this notebook is found at: <a href="https://laurencemoroney.com/datasets.html">https://laurencemoroney.com/datasets.html</a>.  The humans or horses dataset is at <a href="https://storage.googleapis.com/laurencemoroney-blog.appspot.com/horse-or-human.zip">https://storage.googleapis.com/laurencemoroney-blog.appspot.com/horse-or-human.zip</a>.</p><p>Download the zip file. unzip in a directory below where you started livebook from.</p><p>Now we need to setup configuration data for the rest of the notebook.  We need the relative location of the humans_or_horses folder.</p><p>We also need to know how many images to include in the batch.  A batch is the number of images to load into the GPU at a time.  If the batch size is too big for your GPU, i.e. out of memory error, reduce the batch size.  It is generally optimal to utilize almost all of the GPU memory when training.  It will take more time to train with a lower batch size.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HorsesHumans.Config</span><span class="w"> </span><span class="k" data-group-id="8047737753-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">directories</span><span class="w"> </span><span class="k" data-group-id="8047737753-2">do</span><span class="w">
    </span><span class="s">&quot;data/humans_or_horses/{horses,humans}/*&quot;</span><span class="w">
  </span><span class="k" data-group-id="8047737753-2">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">batch_size</span><span class="w"> </span><span class="k" data-group-id="8047737753-3">do</span><span class="w">
    </span><span class="mi">32</span><span class="w">
  </span><span class="k" data-group-id="8047737753-3">end</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">batches_per_epoch</span><span class="w"> </span><span class="k" data-group-id="8047737753-4">do</span><span class="w">
    </span><span class="nc">Path</span><span class="o">.</span><span class="n">wildcard</span><span class="p" data-group-id="8047737753-5">(</span><span class="n">directories</span><span class="p" data-group-id="8047737753-6">(</span><span class="p" data-group-id="8047737753-6">)</span><span class="p" data-group-id="8047737753-5">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="8047737753-7">(</span><span class="p" data-group-id="8047737753-7">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="n">div</span><span class="p" data-group-id="8047737753-8">(</span><span class="n">batch_size</span><span class="p" data-group-id="8047737753-9">(</span><span class="p" data-group-id="8047737753-9">)</span><span class="p" data-group-id="8047737753-8">)</span><span class="w">
  </span><span class="k" data-group-id="8047737753-4">end</span><span class="w">
</span><span class="k" data-group-id="8047737753-1">end</span><span class="w">

</span><span class="kn">alias</span><span class="w"> </span><span class="nc">HorsesHumans.Config</span><span class="p">,</span><span class="w"> </span><span class="ss">as</span><span class="p">:</span><span class="w"> </span><span class="nc">Config</span></code></pre><h2 id="exploratory-analysis" class="section-heading">
  <a href="#exploratory-analysis" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">exploratory-analysis</p>
  </a>
  Exploratory Analysis
</h2>
<p>We'll do a really quick analysis of our data.  We want to make sure the directories configuration points to the correct directory.  Make sure the output shows something like:</p><p>[&quot;data/humans_or_horses/horses/horse01-0.png&quot;, .....</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HorsesHumans.Exploratory</span><span class="w"> </span><span class="k" data-group-id="2913793220-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">check_data_directory</span><span class="w"> </span><span class="k" data-group-id="2913793220-2">do</span><span class="w">
    </span><span class="nc">Enum</span><span class="o">.</span><span class="n">take</span><span class="p" data-group-id="2913793220-3">(</span><span class="nc">Path</span><span class="o">.</span><span class="n">wildcard</span><span class="p" data-group-id="2913793220-4">(</span><span class="nc">Config</span><span class="o">.</span><span class="n">directories</span><span class="p" data-group-id="2913793220-5">(</span><span class="p" data-group-id="2913793220-5">)</span><span class="p" data-group-id="2913793220-4">)</span><span class="p">,</span><span class="w"> </span><span class="mi">10</span><span class="p" data-group-id="2913793220-3">)</span><span class="w">
  </span><span class="k" data-group-id="2913793220-2">end</span><span class="w">
</span><span class="k" data-group-id="2913793220-1">end</span><span class="w">

</span><span class="n">sample_data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">HorsesHumans.Exploratory</span><span class="o">.</span><span class="n">check_data_directory</span><span class="p" data-group-id="2913793220-6">(</span><span class="p" data-group-id="2913793220-6">)</span></code></pre><p>Then, you can derive the expected class from the file name:</p><ul><li>horse when horsenn-nn.png</li><li>human when humannn-nn.png</li></ul><p>Let's look at a sample image.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Enum</span><span class="o">.</span><span class="n">at</span><span class="p" data-group-id="5115347805-1">(</span><span class="n">sample_data</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="5115347805-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">File</span><span class="o">.</span><span class="n">read!</span><span class="p" data-group-id="5115347805-2">(</span><span class="p" data-group-id="5115347805-2">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Kino.Image</span><span class="o">.</span><span class="n">new</span><span class="p" data-group-id="5115347805-3">(</span><span class="ss">:png</span><span class="p" data-group-id="5115347805-3">)</span></code></pre><p>How many images are there?</p><p>How many images will not be used for training? The remainder of the integer division will be ignored.</p><pre><code class="makeup elixir" translate="no"><span class="nc">Path</span><span class="o">.</span><span class="n">wildcard</span><span class="p" data-group-id="7892149774-1">(</span><span class="nc">Config</span><span class="o">.</span><span class="n">directories</span><span class="p" data-group-id="7892149774-2">(</span><span class="p" data-group-id="7892149774-2">)</span><span class="p" data-group-id="7892149774-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="7892149774-3">(</span><span class="p" data-group-id="7892149774-3">)</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">Path</span><span class="o">.</span><span class="n">wildcard</span><span class="p" data-group-id="9043718254-1">(</span><span class="nc">Config</span><span class="o">.</span><span class="n">directories</span><span class="p" data-group-id="9043718254-2">(</span><span class="p" data-group-id="9043718254-2">)</span><span class="p" data-group-id="9043718254-1">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">count</span><span class="p" data-group-id="9043718254-3">(</span><span class="p" data-group-id="9043718254-3">)</span><span class="w">
</span><span class="o">|&gt;</span><span class="w"> </span><span class="n">rem</span><span class="p" data-group-id="9043718254-4">(</span><span class="nc">Config</span><span class="o">.</span><span class="n">batch_size</span><span class="p" data-group-id="9043718254-5">(</span><span class="p" data-group-id="9043718254-5">)</span><span class="p" data-group-id="9043718254-4">)</span></code></pre><h2 id="data-processing" class="section-heading">
  <a href="#data-processing" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">data-processing</p>
  </a>
  Data processing
</h2>
<p>First, we need to preprocess the data for our CNN. At the beginning of the process, we chunk images into batches. We use the <code class="inline">parse_png</code> function to load images and label them accurately. Finally, we &quot;augment&quot; the input, which means that we normalize data and flip the images along one of the axes. The last procedure helps neural network to make predictions regardless of the orientation of the image.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HorsesHumans.DataProcessing</span><span class="w"> </span><span class="k" data-group-id="3254525808-1">do</span><span class="w">
  </span><span class="kn">import</span><span class="w"> </span><span class="nc">Nx.Defn</span><span class="w">

  </span><span class="kd">def</span><span class="w"> </span><span class="nf">data_stream</span><span class="p" data-group-id="3254525808-2">(</span><span class="p" data-group-id="3254525808-2">)</span><span class="w"> </span><span class="k" data-group-id="3254525808-3">do</span><span class="w">
    </span><span class="nc">Path</span><span class="o">.</span><span class="n">wildcard</span><span class="p" data-group-id="3254525808-4">(</span><span class="nc">Config</span><span class="o">.</span><span class="n">directories</span><span class="p" data-group-id="3254525808-5">(</span><span class="p" data-group-id="3254525808-5">)</span><span class="p" data-group-id="3254525808-4">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">chunk_every</span><span class="p" data-group-id="3254525808-6">(</span><span class="nc">Config</span><span class="o">.</span><span class="n">batch_size</span><span class="p" data-group-id="3254525808-7">(</span><span class="p" data-group-id="3254525808-7">)</span><span class="p">,</span><span class="w"> </span><span class="nc">Config</span><span class="o">.</span><span class="n">batch_size</span><span class="p" data-group-id="3254525808-8">(</span><span class="p" data-group-id="3254525808-8">)</span><span class="p">,</span><span class="w"> </span><span class="ss">:discard</span><span class="p" data-group-id="3254525808-6">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Task</span><span class="o">.</span><span class="n">async_stream</span><span class="p" data-group-id="3254525808-9">(</span><span class="w">
      </span><span class="k" data-group-id="3254525808-10">fn</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">-&gt;</span><span class="w">
        </span><span class="p" data-group-id="3254525808-11">{</span><span class="n">inp</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="p" data-group-id="3254525808-11">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">batch</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="3254525808-12">(</span><span class="o">&amp;</span><span class="n">parse_png</span><span class="o">/</span><span class="mi">1</span><span class="p" data-group-id="3254525808-12">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Enum</span><span class="o">.</span><span class="n">unzip</span><span class="p" data-group-id="3254525808-13">(</span><span class="p" data-group-id="3254525808-13">)</span><span class="w">
        </span><span class="p" data-group-id="3254525808-14">{</span><span class="nc">Nx</span><span class="o">.</span><span class="n">stack</span><span class="p" data-group-id="3254525808-15">(</span><span class="n">inp</span><span class="p" data-group-id="3254525808-15">)</span><span class="p">,</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">stack</span><span class="p" data-group-id="3254525808-16">(</span><span class="n">labels</span><span class="p" data-group-id="3254525808-16">)</span><span class="p" data-group-id="3254525808-14">}</span><span class="w">
      </span><span class="k" data-group-id="3254525808-10">end</span><span class="p">,</span><span class="w">
      </span><span class="ss">timeout</span><span class="p">:</span><span class="w"> </span><span class="ss">:infinity</span><span class="w">
    </span><span class="p" data-group-id="3254525808-9">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">map</span><span class="p" data-group-id="3254525808-17">(</span><span class="k" data-group-id="3254525808-18">fn</span><span class="w"> </span><span class="p" data-group-id="3254525808-19">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="3254525808-20">{</span><span class="n">inp</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="p" data-group-id="3254525808-20">}</span><span class="p" data-group-id="3254525808-19">}</span><span class="w"> </span><span class="o">-&gt;</span><span class="w"> </span><span class="p" data-group-id="3254525808-21">{</span><span class="n">augment</span><span class="p" data-group-id="3254525808-22">(</span><span class="n">inp</span><span class="p" data-group-id="3254525808-22">)</span><span class="p">,</span><span class="w"> </span><span class="n">labels</span><span class="p" data-group-id="3254525808-21">}</span><span class="w"> </span><span class="k" data-group-id="3254525808-18">end</span><span class="p" data-group-id="3254525808-17">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Stream</span><span class="o">.</span><span class="n">cycle</span><span class="p" data-group-id="3254525808-23">(</span><span class="p" data-group-id="3254525808-23">)</span><span class="w">
  </span><span class="k" data-group-id="3254525808-3">end</span><span class="w">

  </span><span class="kd">defnp</span><span class="w"> </span><span class="nf">augment</span><span class="p" data-group-id="3254525808-24">(</span><span class="n">inp</span><span class="p" data-group-id="3254525808-24">)</span><span class="w"> </span><span class="k" data-group-id="3254525808-25">do</span><span class="w">
    </span><span class="c1"># Normalize</span><span class="w">
    </span><span class="n">inp</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="n">inp</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="mf">255.0</span><span class="w">

    </span><span class="c1"># For now just a random flip</span><span class="w">
    </span><span class="k">if</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">random_uniform</span><span class="p" data-group-id="3254525808-26">(</span><span class="p" data-group-id="3254525808-27">{</span><span class="p" data-group-id="3254525808-27">}</span><span class="p" data-group-id="3254525808-26">)</span><span class="w"> </span><span class="o">&gt;</span><span class="w"> </span><span class="mf">0.5</span><span class="w"> </span><span class="k" data-group-id="3254525808-28">do</span><span class="w">
      </span><span class="nc">Nx</span><span class="o">.</span><span class="n">reverse</span><span class="p" data-group-id="3254525808-29">(</span><span class="n">inp</span><span class="p">,</span><span class="w"> </span><span class="ss">axes</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3254525808-30">[</span><span class="mi">0</span><span class="p" data-group-id="3254525808-30">]</span><span class="p" data-group-id="3254525808-29">)</span><span class="w">
    </span><span class="k" data-group-id="3254525808-28">else</span><span class="w">
      </span><span class="nc">Nx</span><span class="o">.</span><span class="n">reverse</span><span class="p" data-group-id="3254525808-31">(</span><span class="n">inp</span><span class="p">,</span><span class="w"> </span><span class="ss">axes</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3254525808-32">[</span><span class="mi">1</span><span class="p" data-group-id="3254525808-32">]</span><span class="p" data-group-id="3254525808-31">)</span><span class="w">
    </span><span class="k" data-group-id="3254525808-28">end</span><span class="w">
  </span><span class="k" data-group-id="3254525808-25">end</span><span class="w">

  </span><span class="kd">defp</span><span class="w"> </span><span class="nf">parse_png</span><span class="p" data-group-id="3254525808-33">(</span><span class="n">filename</span><span class="p" data-group-id="3254525808-33">)</span><span class="w"> </span><span class="k" data-group-id="3254525808-34">do</span><span class="w">
    </span><span class="n">class</span><span class="w"> </span><span class="o">=</span><span class="w">
      </span><span class="k">if</span><span class="w"> </span><span class="nc">String</span><span class="o">.</span><span class="n">contains?</span><span class="p" data-group-id="3254525808-35">(</span><span class="n">filename</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;horses&quot;</span><span class="p" data-group-id="3254525808-35">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">do</span><span class="p">:</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="3254525808-36">(</span><span class="p" data-group-id="3254525808-37">[</span><span class="mi">1</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p" data-group-id="3254525808-37">]</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3254525808-38">{</span><span class="ss">:u</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p" data-group-id="3254525808-38">}</span><span class="p" data-group-id="3254525808-36">)</span><span class="p">,</span><span class="w">
        </span><span class="ss">else</span><span class="p">:</span><span class="w"> </span><span class="nc">Nx</span><span class="o">.</span><span class="n">tensor</span><span class="p" data-group-id="3254525808-39">(</span><span class="p" data-group-id="3254525808-40">[</span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="3254525808-40">]</span><span class="p">,</span><span class="w"> </span><span class="ss">type</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="3254525808-41">{</span><span class="ss">:u</span><span class="p">,</span><span class="w"> </span><span class="mi">8</span><span class="p" data-group-id="3254525808-41">}</span><span class="p" data-group-id="3254525808-39">)</span><span class="w">

    </span><span class="p" data-group-id="3254525808-42">{</span><span class="ss">:ok</span><span class="p">,</span><span class="w"> </span><span class="n">img</span><span class="p" data-group-id="3254525808-42">}</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StbImage</span><span class="o">.</span><span class="n">read_file</span><span class="p" data-group-id="3254525808-43">(</span><span class="n">filename</span><span class="p" data-group-id="3254525808-43">)</span><span class="w">
    </span><span class="n">tensor</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">StbImage</span><span class="o">.</span><span class="n">to_nx</span><span class="p" data-group-id="3254525808-44">(</span><span class="n">img</span><span class="p" data-group-id="3254525808-44">)</span><span class="w">

    </span><span class="p" data-group-id="3254525808-45">{</span><span class="n">tensor</span><span class="p">,</span><span class="w"> </span><span class="n">class</span><span class="p" data-group-id="3254525808-45">}</span><span class="w">
  </span><span class="k" data-group-id="3254525808-34">end</span><span class="w">
</span><span class="k" data-group-id="3254525808-1">end</span></code></pre><h2 id="building-model" class="section-heading">
  <a href="#building-model" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">building-model</p>
  </a>
  Building Model
</h2>
<p>The next step is creating a model architecture. In the notebook, we choose classic Convolutional Neural Net architecture. Let's dive in to the core components of a CNN.</p><p><code class="inline">Axon.conv</code> creates a convolutional layer. The convolutional layer is a core of CNNs. For a given <em>kernel_size</em>, it applies a filter function through the image to separate features which differ images from each other.</p><table><thead><tr><th style="text-align: center;"><img src="https://miroslawmamczur.pl/wp-content/uploads/2021/03/06.gif" alt=""/></th></tr></thead><tbody><tr><td style="text-align: center;">Figure 1: An example of convolutional layer works for <em>kernel_size</em>={3,3}</td></tr></tbody></table><p><code class="inline">Axon.max_pool</code> is a mathematical operation which gives the maximum value from a subtensor of a size equal to <em>kernel_size</em>.</p><table><thead><tr><th style="text-align: center;"><img src="https://production-media.paperswithcode.com/methods/MaxpoolSample2.png" alt=""/></th></tr></thead><tbody><tr><td style="text-align: center;">Figure 2: Max pooling operation for <em>kernel_size</em>={2,2}</td></tr></tbody></table><p>Axon.dropout and Axon.spatial_dropout create dropout layers which prevent the neural network from overfitting. Standard dropout drops a given rate of randomly chosen neurons during the training process. On the other hand, spatial dropout gets rid of whole feature maps. The graphical difference between dropout and spatial dropout is presented in a picture below.</p><table><thead><tr><th style="text-align: center;"><img src="https://miro.medium.com/max/1400/1*KkqxjvXTIV_b365B41ltfg.png" alt=""/></th></tr></thead><tbody><tr><td style="text-align: center;">Figure 3: The difference between standard dropout and spatial dropout</td></tr></tbody></table><p>And eventually, we get the model build. At the end of the CNN, we use one dense layer with 512 neurons and an output layer with two neurons and a softmax function.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HorsesHumans.Model</span><span class="w"> </span><span class="k" data-group-id="9310053167-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">build_model</span><span class="p" data-group-id="9310053167-2">(</span><span class="n">input_shape</span><span class="p">,</span><span class="w"> </span><span class="n">transpose_shape</span><span class="p" data-group-id="9310053167-2">)</span><span class="w"> </span><span class="k" data-group-id="9310053167-3">do</span><span class="w">
    </span><span class="nc">Axon</span><span class="o">.</span><span class="n">input</span><span class="p" data-group-id="9310053167-4">(</span><span class="n">input_shape</span><span class="p">,</span><span class="w"> </span><span class="s">&quot;input&quot;</span><span class="p" data-group-id="9310053167-4">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">transpose</span><span class="p" data-group-id="9310053167-5">(</span><span class="n">transpose_shape</span><span class="p" data-group-id="9310053167-5">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">conv</span><span class="p" data-group-id="9310053167-6">(</span><span class="mi">16</span><span class="p">,</span><span class="w"> </span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-7">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9310053167-7">}</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="9310053167-6">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">max_pool</span><span class="p" data-group-id="9310053167-8">(</span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-9">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9310053167-9">}</span><span class="p" data-group-id="9310053167-8">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">conv</span><span class="p" data-group-id="9310053167-10">(</span><span class="mi">32</span><span class="p">,</span><span class="w"> </span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-11">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9310053167-11">}</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="9310053167-10">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">spatial_dropout</span><span class="p" data-group-id="9310053167-12">(</span><span class="ss">rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p" data-group-id="9310053167-12">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">max_pool</span><span class="p" data-group-id="9310053167-13">(</span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-14">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9310053167-14">}</span><span class="p" data-group-id="9310053167-13">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">conv</span><span class="p" data-group-id="9310053167-15">(</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-16">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9310053167-16">}</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="9310053167-15">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">spatial_dropout</span><span class="p" data-group-id="9310053167-17">(</span><span class="ss">rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p" data-group-id="9310053167-17">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">max_pool</span><span class="p" data-group-id="9310053167-18">(</span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-19">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9310053167-19">}</span><span class="p" data-group-id="9310053167-18">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">conv</span><span class="p" data-group-id="9310053167-20">(</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-21">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9310053167-21">}</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="9310053167-20">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">max_pool</span><span class="p" data-group-id="9310053167-22">(</span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-23">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9310053167-23">}</span><span class="p" data-group-id="9310053167-22">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">conv</span><span class="p" data-group-id="9310053167-24">(</span><span class="mi">64</span><span class="p">,</span><span class="w"> </span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-25">{</span><span class="mi">3</span><span class="p">,</span><span class="w"> </span><span class="mi">3</span><span class="p" data-group-id="9310053167-25">}</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="9310053167-24">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">max_pool</span><span class="p" data-group-id="9310053167-26">(</span><span class="ss">kernel_size</span><span class="p">:</span><span class="w"> </span><span class="p" data-group-id="9310053167-27">{</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="9310053167-27">}</span><span class="p" data-group-id="9310053167-26">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">flatten</span><span class="p" data-group-id="9310053167-28">(</span><span class="p" data-group-id="9310053167-28">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dropout</span><span class="p" data-group-id="9310053167-29">(</span><span class="ss">rate</span><span class="p">:</span><span class="w"> </span><span class="mf">0.5</span><span class="p" data-group-id="9310053167-29">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="9310053167-30">(</span><span class="mi">512</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:relu</span><span class="p" data-group-id="9310053167-30">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon</span><span class="o">.</span><span class="n">dense</span><span class="p" data-group-id="9310053167-31">(</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="ss">activation</span><span class="p">:</span><span class="w"> </span><span class="ss">:softmax</span><span class="p" data-group-id="9310053167-31">)</span><span class="w">
  </span><span class="k" data-group-id="9310053167-3">end</span><span class="w">
</span><span class="k" data-group-id="9310053167-1">end</span></code></pre><h2 id="training" class="section-heading">
  <a href="#training" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">training</p>
  </a>
  Training
</h2>
<p>Creating a training loop starts with setting a loss function to categorical cross-entropy and optimizer of your choice. We also set the log option to 1 to keep track of loss and metrics during training. Next, we choose accuracy as a metric. Finally, we pass the number of epochs and set the number of iterations per epoch to utilize almost all of the images.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HorsesHumans.Training</span><span class="w"> </span><span class="k" data-group-id="4311993653-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">train_model</span><span class="p" data-group-id="4311993653-2">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">,</span><span class="w"> </span><span class="n">epochs</span><span class="p" data-group-id="4311993653-2">)</span><span class="w"> </span><span class="k" data-group-id="4311993653-3">do</span><span class="w">
    </span><span class="n">model</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">trainer</span><span class="p" data-group-id="4311993653-4">(</span><span class="ss">:categorical_cross_entropy</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">,</span><span class="w"> </span><span class="ss">log</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="4311993653-4">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">metric</span><span class="p" data-group-id="4311993653-5">(</span><span class="ss">:accuracy</span><span class="p" data-group-id="4311993653-5">)</span><span class="w">
    </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">Axon.Loop</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="4311993653-6">(</span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="4311993653-7">%{</span><span class="p" data-group-id="4311993653-7">}</span><span class="p">,</span><span class="w"> </span><span class="ss">epochs</span><span class="p">:</span><span class="w"> </span><span class="n">epochs</span><span class="p">,</span><span class="w"> </span><span class="ss">iterations</span><span class="p">:</span><span class="w"> </span><span class="nc">Config</span><span class="o">.</span><span class="n">batches_per_epoch</span><span class="p" data-group-id="4311993653-8">(</span><span class="p" data-group-id="4311993653-8">)</span><span class="p" data-group-id="4311993653-6">)</span><span class="w">
  </span><span class="k" data-group-id="4311993653-3">end</span><span class="w">
</span><span class="k" data-group-id="4311993653-1">end</span></code></pre><h2 id="model-evaluation" class="section-heading">
  <a href="#model-evaluation" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">model-evaluation</p>
  </a>
  Model evaluation
</h2>
<p>Now we can build and train our model. We start with passing input shape and indices to data transposition. Next, we set the optimizer to adam with a learning rate of 1.0e-4. In the next step, we define an optimizer but with gradient centralization. It is a technique with a similar purpose to batch normalization. For each loss gradient, we subtract a mean value to have a gradient with mean equal to zero. This process prevents us from exploding gradients.</p><pre><code class="makeup elixir" translate="no"><span class="kd">defmodule</span><span class="w"> </span><span class="nc">HorsesHumans.ModelTraining</span><span class="w"> </span><span class="k" data-group-id="7464696047-1">do</span><span class="w">
  </span><span class="kd">def</span><span class="w"> </span><span class="nf">run</span><span class="p" data-group-id="7464696047-2">(</span><span class="p" data-group-id="7464696047-2">)</span><span class="w"> </span><span class="k" data-group-id="7464696047-3">do</span><span class="w">
    </span><span class="n">model</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">HorsesHumans.Model</span><span class="o">.</span><span class="n">build_model</span><span class="p" data-group-id="7464696047-4">(</span><span class="p" data-group-id="7464696047-5">{</span><span class="no">nil</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">300</span><span class="p">,</span><span class="w"> </span><span class="mi">4</span><span class="p" data-group-id="7464696047-5">}</span><span class="p">,</span><span class="w"> </span><span class="p" data-group-id="7464696047-6">[</span><span class="mi">2</span><span class="p">,</span><span class="w"> </span><span class="mi">0</span><span class="p">,</span><span class="w"> </span><span class="mi">1</span><span class="p" data-group-id="7464696047-6">]</span><span class="p" data-group-id="7464696047-4">)</span><span class="w"> </span><span class="o">|&gt;</span><span class="w"> </span><span class="nc">IO</span><span class="o">.</span><span class="n">inspect</span><span class="p" data-group-id="7464696047-7">(</span><span class="p" data-group-id="7464696047-7">)</span><span class="w">
    </span><span class="n">optimizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon.Optimizers</span><span class="o">.</span><span class="n">adam</span><span class="p" data-group-id="7464696047-8">(</span><span class="mf">1.0e-4</span><span class="p" data-group-id="7464696047-8">)</span><span class="w">
    </span><span class="n">centralized_optimizer</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">Axon.Updates</span><span class="o">.</span><span class="n">compose</span><span class="p" data-group-id="7464696047-9">(</span><span class="nc">Axon.Updates</span><span class="o">.</span><span class="n">centralize</span><span class="p" data-group-id="7464696047-10">(</span><span class="p" data-group-id="7464696047-10">)</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p" data-group-id="7464696047-9">)</span><span class="w">

    </span><span class="n">data</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nc">HorsesHumans.DataProcessing</span><span class="o">.</span><span class="n">data_stream</span><span class="p" data-group-id="7464696047-11">(</span><span class="p" data-group-id="7464696047-11">)</span><span class="w">

    </span><span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="p" data-group-id="7464696047-12">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="se">\n</span><span class="s">Training model without gradient centralization</span><span class="se">\n</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="7464696047-12">)</span><span class="w">
    </span><span class="nc">HorsesHumans.Training</span><span class="o">.</span><span class="n">train_model</span><span class="p" data-group-id="7464696047-13">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">optimizer</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7464696047-13">)</span><span class="w">

    </span><span class="nc">IO</span><span class="o">.</span><span class="n">write</span><span class="p" data-group-id="7464696047-14">(</span><span class="s">&quot;</span><span class="se">\n</span><span class="se">\n</span><span class="s">Training model with gradient centralization</span><span class="se">\n</span><span class="se">\n</span><span class="s">&quot;</span><span class="p" data-group-id="7464696047-14">)</span><span class="w">
    </span><span class="nc">HorsesHumans.Training</span><span class="o">.</span><span class="n">train_model</span><span class="p" data-group-id="7464696047-15">(</span><span class="n">model</span><span class="p">,</span><span class="w"> </span><span class="n">data</span><span class="p">,</span><span class="w"> </span><span class="n">centralized_optimizer</span><span class="p">,</span><span class="w"> </span><span class="mi">2</span><span class="p" data-group-id="7464696047-15">)</span><span class="w">
  </span><span class="k" data-group-id="7464696047-3">end</span><span class="w">
</span><span class="k" data-group-id="7464696047-1">end</span></code></pre><pre><code class="makeup elixir" translate="no"><span class="nc">HorsesHumans.ModelTraining</span><span class="o">.</span><span class="n">run</span><span class="p" data-group-id="7128477515-1">(</span><span class="p" data-group-id="7128477515-1">)</span></code></pre><h2 id="conclusions" class="section-heading">
  <a href="#conclusions" class="hover-link"><i class="ri-link-m" aria-hidden="true"></i>
  <p class="sr-only">conclusions</p>
  </a>
  Conclusions
</h2>
<p>We have an accuracy of almost 1.0.  That is great right?  Hmmm. Not so great.  With this notebook we've demonstrated the ability for a neural net model to memorize a dataset.  The model knows how to distinguish each image with the kind of image it is.  Training a model is tricky.  It may learn unintended characteristics.  Do all of the horses have something in the background that the model can make it's decision on?</p><p>For useful models, we need to compare the model against images that it hasn't seen.  Comparison against unseen input data measures the generalization of the model with respect to the unseen images.  Using the model against further unseen images will help with measure the bias of the model.  How well will this model perform against a real horse or pony?</p>
<div class="bottom-actions">
  <div class="bottom-actions-item">

      <a href="mnist.html" class="bottom-actions-button" rel="prev">
        <span class="subheader">
          ← Previous Page
        </span>
        <span class="title">
Classifying handwritten digits
        </span>
      </a>

  </div>
  <div class="bottom-actions-item">

      <a href="text_generator.html" class="bottom-actions-button" rel="next">
        <span class="subheader">
          Next Page →
        </span>
        <span class="title">
Generating text with an LSTM
        </span>
      </a>

  </div>
</div>

      <footer class="footer">

          <p>
            On Hex.pm:

            <span class="line">
              <a href="https://hex.pm/packages/axon/0.2.0" class="line footer-hex-package">Package</a>
              <a href="https://preview.hex.pm/preview/axon/0.2.0" class="line">Preview</a>

                <a href="https://preview.hex.pm/preview/axon/0.2.0/show/notebooks/vision/humans_or_horses.livemd">(current file)</a>

            </span>

            <button class="line footer-button display-quick-switch">
              Search
            </button>
          </p>

        <p>
          Built using
          <a href="https://github.com/elixir-lang/ex_doc" title="ExDoc" target="_blank" rel="help noopener" translate="no">ExDoc</a> (v0.28.5) for the

            <a href="https://elixir-lang.org" title="Elixir" target="_blank" translate="no">Elixir programming language</a>

        </p>
      </footer>
    </div>
  </div>
</section>
</div>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.css" integrity="sha384-t5CR+zwDAROtph0PXGte6ia8heboACF9R5l/DiY+WZ3P2lxNgvJkQk5n7GPvLMYw" crossorigin="anonymous">
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/katex.min.js" integrity="sha384-FaFLTlohFghEIZkw6VGwmf9ISTubWAVYW8tG8+w2LAIftJEULZABrF9PPFv+tVkH" crossorigin="anonymous"></script>
<script defer src="https://cdn.jsdelivr.net/npm/katex@0.13.0/dist/contrib/auto-render.min.js" integrity="sha384-bHBqxz8fokvgoJ/sc17HODNxa42TlaEhB+w8ZJXTc2nZf1VgEaFZeZvT4Mznfz0v" crossorigin="anonymous"
    onload="renderMathInElement(document.body);"></script>

  </body>
</html>
